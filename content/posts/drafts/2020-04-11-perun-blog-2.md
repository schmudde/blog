---
title: How to use Perun to Create a Static Blog &bull; Part 2
description: Adding style
author: David Schmudde
author-email: d@schmud.de
author-url: http://schmud.de
author-github: schmudde
author-twitter: dschmudde
author-avatar: /images/anton-avatar.png
location: Turin, Italy
date-created: 2013-12-27
date-modified: 2013-12-30
date-published:
in-language: en
canonical-url: http://schmud.de
uuid:
tags:
 - clojure
 - tools
---


The blog is functional but it certainly is unattractive. Particularly, the text hierarchy is difficult to read. Time to add a little style.

Before getting started, I'm going to improve our workflow. It's worth the time invested. You won't want to go back to traditional methods once you experience interactive programming from Clojure's REPL.

## Interactive Programming

[LiveReload](http://livereload.com/) essentially hits the refresh for you.

[boot-livereload](https://github.com/Deraen/boot-livereload): live-reload of browser JS, HTML, CSS and images.

Add another tool to the development toolchain. Open the `build-boot` and add a new package to `:dependencies` called [boot-livereload](https://github.com/Deraen/boot-livereload).

- Here is the code for the latest version: `[deraen/boot-livereload "0.2.1"]`.
- Add this to `build.boot`'s `require` function: `'[deraen.boot-livereload :refer [livereload]]`

Now save the JavaScript that [LiveReload requires](http://livereload.com/browser/script-tag/) to a file called `livereload.js` under `resources/js/livereload.js`:

```
document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
```
Perun offers an elegant way to inject the script into every page in the development environment. Under `(deftask dev []...` add `(perun/inject-scripts :scripts #{"js/livereload.js"})` followed by `(livereload :asset-path "public" :filter #"\.(css|html|js)$")`.

## Adding Style

### Download the Stylesheet

[Tachyons](http://tachyons.io/) offers basic layout and styling options.

1. Create a `css` dictory under `resources/public/css`.
2. Navigate to `resources/pubilc/css`.
3. un this command: `curl -O https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css` or [download it manually](https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css`).

### Create a HTML `<head>` Function

The HTML `<head>` contains a lot of important information.

```
(defn head [global-meta & [post]]
  [:head
   [:title (:site-title global-meta) (if post (str " | " (:title post)))]
   [:meta {:charset "utf-8"}]
   [:meta {:http-equiv "X-UA-Compatible" :content "IE=edge,chrome=1"}]
   [:meta {:name "viewport" :content "width=device-width, initial-scale=1.0, user-scalable=no"}]
   [:link {:rel "stylesheet" :href "/css/tachyons.min.css"}]]
  )
```

Two tags are of direct imporance:

- `[:title (:site-title global-meta) (if post (str " | " (:title post)))]`
- `[:link {:rel "stylesheet" :href "/css/tachyons.min.css"}]`

The title of the site is taken from the global metadata supplied in `site.base.edn`. If the page is a post, the title of the post is also provided.

The link points directly to the stylesheet that we just created.

The new `head` function must be included in the `render` function of all the hiccup generators: `index.clj`, `about.clj`, and `post.clj`. Here's an example from `index.clj`:

```
(defn render [{global-meta :meta posts :entries}]
  (page/html5 {:lang "en" :itemtype "http://schema.org/Blog"}
         (head global-meta)
```

### Apply the Stylesheet

`index.clj`

Going back to the `header` fucntion, it is time to style the title, subtitle, and menu.

```
(defn header [global-meta]
  [:header
   [:nav
    [:h1.tc.f1.db.tc [:a.link.black {:href "/" :title "Home"} (:site-title global-meta)]]
    [:p.tc.f2 (:description global-meta)]
    [:ul.list.tc
     [:li.dib.mr2 [:a.link {:href "/about.html" :title "About"} "About"]]
     [:li.dib.mr2 [:a.link {:href "/feed.rss" :title "rss"} "RSS"]]]]])
```

`h1` and `p` are centered with `.tc`. `h1` also gets...

`post.clj`

Style the main content: `[:main.pa4 {:role "main"} (:content post)]`.

## Display the Most Recent Post on the Landing Page

Displaying the most recent post requires a better understanding of how Perun renders pages. Specifically, this section from the `build` in `build.boot`:

```
(comp [...]
  (perun/collection :renderer 'site.index/index-page :page "index.html")
  (perun/render :renderer 'site.index/post-page)
  [...])
```

`(perun/render :renderer 'site.index/post-page)`

1. The `render` task reads the files from Boot's temporary file store: `(slurp (boot/tmp-file (boot/tmp-get fileset path)))`
2. It applies the blog post template to everythign it reads: `:renderer 'site.index/post-page`.
    - A function called `render-task` makes sure the `:renderer` it is passed is valid.
    - `render-task` passes a function called `content-task` which actually does the parsing of the input and orchestrates the output back to `tmp`.

`(perun/collection :renderer 'site.index/index-page :page "index.html")`

The `collection` task calls a function that orchestrates the aggregation of all blog content that should be displayed on a single page. For example, a collection of all posts that are *public*, earlier than a certain date, etc&hellip;. The elements of this collection are then passed through the `render-task` &rarr; `content-task` pipepline.

**This includes reading and writing to the same temporary storage**. In the current configuration, `index.html` gets rendered twice. Once as part of the `collection` task that creates `index.html` and the second time as part of the `render` task that applies the `post-page` template. This can cause unexpected output.

`index.html` is a webpage, not a blog post. Add a filter to the `post-page` `render` task to ensure it just renders posts.

This anonymous function [supplied by Martin Klepsch](https://github.com/martinklepsch/martinklepsch.org/blob/04c6229ce5b931ddf2cd94d677afa5588bc1c693/build.boot#L54) supplies only the files that originally existed in the `posts` directory: `(fn [{:keys [original-path] :as meta}] (some-> original-path (.startsWith "posts/")))`.

`original-path` is part of the metadata supplied with every file in Perun. To see the metadata, add `(perun/print-meta)` to `build.boot`'s `dev` task. The metadata for this post:

```
{:author "David Schmudde",
  [...]
  :original-path "posts/2020-04-11-perun-blog-2.md",
  :out-dir "public",
  :parent-path "public/posts/",
  :path "public/posts/2020-04-11-perun-blog-2.html",
  :permalink "/posts/2020-04-11-perun-blog-2.html",
  [...]
  :io.perun/trace [:io.perun/yaml-metadata :io.perun/markdown :io.perun/render]}
```

The final `collection` and `render` tasks together:

```
(perun/collection :renderer 'site.index/index-page :page "index.html")
(perun/render :renderer 'site.index/post-page
              :filterer (fn [{:keys [original-path] :as m}] (some-> original-path (.startsWith "posts/"))))
```
